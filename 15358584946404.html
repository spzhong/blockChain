<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  一篇对比特币挖矿的理解 - 我对区块链的理解
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="我对区块链的理解" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site: ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>

<link rel="stylesheet" type="text/css" href="asset/sample-custom-html-charts/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="asset/sample-custom-html-charts/mermaid.css">
<!--        <link rel="stylesheet" type="text/css" href="asset/sample-custom-html-charts/mermadidstyle.css">-->
            <script type="text/javascript" src="asset/sample-custom-html-charts/jquery_plantuml/jquery.js"></script>
            <script type="text/javascript" src="asset/sample-custom-html-charts/jquery_plantuml/rawdeflate.js"></script>
            <script type="text/javascript" src="asset/sample-custom-html-charts/jquery_plantuml/encode64.js"></script>
            <script src="asset/sample-custom-html-charts/echarts.common.min.js"></script>
            <script src="asset/sample-custom-html-charts/mermaid.min.js"></script>
            <script type="text/javascript">
                $(function(){
                  var mwebii=0;
                  var mwebChartEleId = 'mweb-chart-ele-';
                  $('pre>code').each(function(){
                                     mwebii++;
                                     var eleiid = mwebChartEleId+mwebii;
                                     if($(this).hasClass('language-mermaid')){
                                     var ele = $(this).addClass('nohighlight').parent();
                                     ele.hide();
                                     $('<div id="'+eleiid+'"></div>').addClass('mermaid').html($(this).text()).insertAfter(ele);
                                     }else if($(this).hasClass('language-plantuml')){
                                     var ele = $(this).addClass('nohighlight').parent();
                                     ele.hide();
                                     var str = unescape(encodeURIComponent($(this).text()));
                                     var imgURL = "http://www.plantuml.com/plantuml/svg/"+encode64(deflate(str,9));
                                     var newEle = $('<div id="'+eleiid+'"><img src="'+imgURL+'" /></div>').insertAfter(ele);
                                     }else if($(this).hasClass('language-js-echarts')){
                                     var ele = $(this).addClass('nohighlight').parent();
                                     ele.hide();
                                     $('<div style="width: 100%;height:400px;" id="'+eleiid+'"></div>').insertAfter(ele);
                                     var myChart = echarts.init(document.getElementById(eleiid));
                                     try  {
                                     eval($(this).text());
                                     myChart.setOption(option);
                                     }catch(exception) {}
                                     }
                                     });
                  
                  mermaid.init({noteMargin: 10}, ".mermaid");
                  });
                </script>



  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">首页</a></li>
        
        <li id=""><a target="_self" href="archives.html">归档</a></li>
        
        <li id=""><a target="_self" href="about.html">关于</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="https://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 我对区块链的理解</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">首页</a></li>
        
        <li><a target="_self" href="archives.html">归档</a></li>
        
        <li><a target="_self" href="about.html">关于</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="about.html">关于</a></li>
        
            <li><a href="bit.html">比特币</a></li>
        
            <li><a href="ethereum.html">以太坊</a></li>
        
            <li><a href="poofAlgorithm.html">共识算法</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>一篇对比特币挖矿的理解</h1>
     
        <div class="read-more clearfix">
          <span class="date">2018/9/2</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='bit.html'>比特币</a></span>
           
         
          <span class="comments">
            
              <a href="15358584946404.html#disqus_thread">comments</a>
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <p>一开始大家的立即挖矿的目的用于创造每个区块及获得到的奖励，虽然说，挖矿能够获得这种奖励作为激励但是，他的主要目的不是奖励或产生新币<br/>
挖矿的最重要的作用是，解决区块数据的共识机制，也可以说是基于P2P去中心化的数字货币安全机制</p>

<blockquote>
<p>对于矿工的奖励有两种，一种是写入新块的新币发行，另外一种是交易费的奖励</p>
</blockquote>

<p>矿工们验证每一笔新的交易并把它们记录在总帐本上，每10分钟就会有一个新的区块被“挖掘”出来，每个区块里包含着从上一个区块产生到目前这段时间内发生的所有交易，这些交易被依次添加到区块链中，把打包在区块内且写入链中的交易称为“确认”的交易，交易经过“确认”后，新的拥有者才能够花费他在交易中得到的比特币</p>

<p>矿工为了得到这些奖励，矿工们争相完成一种基于哈希加密算法的数学难题，这些难题的答案包括在新的区块中，作为矿工的计算工作量证明，被称为“工作量证明”，该算法的竞争机制以及获胜者有权将交易写入区块链上</p>

<p>挖矿的奖励设计的速度是递减模式，类似于贵金属的挖矿过程，矿工初始挖矿奖励是50个比特币，每四年（或者说每210000个块）减半，至到大约2140年，不会再产生新的比特币</p>

<p>矿工的交易费，是每一笔交易的输入和输出的差额，这笔费用占用矿工收入的0.5%或者更少，随着挖矿奖励递减，以及每个区块中包含的交易数量增加，交易费占矿工的收益占比会逐渐增加，到2140年，所有的矿工收益都将由交易费构成</p>

<ul>
<li>
<a href="#toc_0">比特币经济学</a>
</li>
<li>
<a href="#toc_1">􏺋􏹪􏰈􏰉挖矿节点和打包交易至区块</a>
<ul>
<li>
<a href="#toc_2">创币交易</a>
</li>
<li>
<a href="#toc_3">Coinbase奖励与矿工费</a>
</li>
</ul>
</li>
<li>
<a href="#toc_4">工作量证明算法</a>
<ul>
<li>
<a href="#toc_5">原理及实现</a>
</li>
<li>
<a href="#toc_6">难度表示，难度目标与难度调整</a>
<ul>
<li>
<a href="#toc_7">难度位</a>
</li>
<li>
<a href="#toc_8">随机数</a>
</li>
<li>
<a href="#toc_9">难度值与调整</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_10">区块链的组装与选择</a>
</li>
<li>
<a href="#toc_11">区块链的分叉</a>
<ul>
<li>
<a href="#toc_12">挖矿</a>
<ul>
<li>
<a href="#toc_13">CPU挖矿</a>
</li>
<li>
<a href="#toc_14">GPU挖矿</a>
</li>
<li>
<a href="#toc_15">FPGA 挖矿</a>
</li>
<li>
<a href="#toc_16">ASIC 矿机挖矿</a>
</li>
<li>
<a href="#toc_17">Ulord 全民挖矿</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_18">共识攻击</a>
<ul>
<li>
<a href="#toc_19">双重支付攻击</a>
</li>
<li>
<a href="#toc_20">拒绝某个特定比特币地址提供服务</a>
</li>
<li>
<a href="#toc_21">51%攻击</a>
</li>
</ul>
</li>
<li>
<a href="#toc_22">改变共识规则</a>
<ul>
<li>
<a href="#toc_23">硬分叉</a>
</li>
<li>
<a href="#toc_24">分离矿工和难度</a>
</li>
<li>
<a href="#toc_25">软分叉</a>
<ul>
<li>
<a href="#toc_26">软分叉重新定义NOP操作码</a>
</li>
<li>
<a href="#toc_27">其他方式软分叉升级</a>
</li>
<li>
<a href="#toc_28">对软分叉的批评</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_29">使用区块版本发出软分叉信号</a>
</li>
</ul>


<h2 id="toc_0">比特币经济学</h2>

<p>总量有限并且发行速度递减创造了一种紧缩的货币供应模式<br/>
法币被中央银行无限制的印刷，而比特币不会因为超额印发而出现膨胀</p>

<p>在通货紧缩时期，人们预期者商品的价格会下跌，人们将会存储货币，避免花点它。这种现象充斥着日本经济“失去的十年”，就是因为在需求坍塌之后导致的停滞状态</p>

<blockquote>
<p>通货紧缩<br/>
是一种由于货币供应和需求不匹配导致的货币增值的现象，许多经济学专家认为，通货紧缩本身不坏，它是遵循一种预定且有节制的货币供应的模型</p>
</blockquote>

<p>通货膨胀导致导致货币贬值，这是一种隐形税收的形式，惩罚在银行存钱的人从而实现解救债务人，政府控制下的货币容易遭受债务发行的道德风险，之后可能会以牺牲存储者为代价，通过贬值来抹去债务</p>

<h2 id="toc_1">􏺋􏹪􏰈􏰉挖矿节点和打包交易至区块</h2>

<p>在比特币网络中，有些节点被称为专业节点的“矿工”</p>

<p>验证交易后，比特币节点将会把这些交易添加到自己的交易池中，用来暂存尚未被加入的区块的交易记录，矿工会把这些交易整合到一个候选区块中</p>

<p>一个完整区块的数据结构</p>

<pre><code class="language-javascript">{
&quot;hash&quot; : &quot;0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4&quot;,
&quot;confirmations&quot; : 35561,
&quot;size&quot; : 218629,
&quot;height&quot; : 277316,
&quot;version&quot; : 2,
&quot;merkleroot&quot; :  &quot;c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e&quot;,
&quot;tx&quot; : [
&quot;d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f&quot;,
&quot;b268b45c59b39d759614757718b9918caf0ba9d97c56f3b91956ff877c503fbe&quot;,
&quot;....&quot;
],
&quot;time&quot; : 1388185914,
&quot;nonce&quot; : 924591752,
&quot;bits&quot; : &quot;1903a30c&quot;,
&quot;difficulty&quot; : 1180923195.25802612,
&quot;chainwork&quot; :&quot;000000000000000000000000000000000000000000000934695e92aaf53afa1a&quot;,
&quot;previousblockhash&quot; :&quot;0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569&quot;
}
</code></pre>

<h3 id="toc_2">创币交易</h3>

<p>创币交易是一笔特殊的交易，称为coinbase交易，这个交易是由矿工节挖矿所得的奖励</p>

<p>与常规的交易不同，创币交易没有输入，不消耗UTXO，它只包含一个作为coinbase的输入，仅仅用来创建新的比特币</p>

<p>创币交易的数据结构</p>

<pre><code class="language-javascript">&quot;hex&quot; : &quot;01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0f03443b0403858402062f503253482fffffffff0110c08d9500000000232102aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21ac00000000&quot;,
&quot;txid&quot; : &quot;d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f&quot;,
&quot;version&quot; : 1,
&quot;locktime&quot; : 0,
&quot;vin&quot; : [
    {
         &quot;coinbase&quot; : &quot;03443b0403858402062f503253482f&quot;,
         &quot;sequence&quot; : 4294967295
    }
],
&quot;vout&quot; : [
    {
        &quot;value&quot; : 25.09094928,
        &quot;n&quot; : 0,
        &quot;scriptPubKey&quot; : {
            &quot;asm&quot; :&quot;02aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21OP_CHECKSIG&quot;,   &quot;hex&quot; :&quot;2102aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21ac&quot;,
            &quot;reqSigs&quot; : 1,
            &quot;type&quot; : &quot;pubkey&quot;,
            &quot;addresses&quot; : [&quot;1MxTkeEP2PmHSMze5tUZ1hAV3YTKu2Gh1N&quot;]
        } 
    }
] 
</code></pre>

<h3 id="toc_3">Coinbase奖励与矿工费</h3>

<p>􏱭􏴓􏰲􏵞coinbase = 􏺢􏺣􏷼􏰆奖励 + 交易费</p>

<pre><code class="language-text">//交易费
Total Fees = Sum(Inputs) - Sum(Outputs)

//奖励
int halvings = curHeight /  210000
if (halvings &gt;= 64) return 0;
int nSubsidy = 50;
nSubsidy &gt;&gt; halvings
return nSubsidy;
</code></pre>

<h2 id="toc_4">工作量证明算法</h2>

<h3 id="toc_5">原理及实现</h3>

<p>原理就是重复的计算区块头的哈希值，不断修改参数，知道与哈希值匹配的一个过程，对于特定输入，哈希的结果每次都一样，任何人都可以用相同的哈希函数，计算和验证结果；</p>

<pre><code class="language-text">一个256位的数字，转换为16进制的话是64位，例如:
0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff，这是一个极大的值（ 2^256 ）

将该值右移16位
0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff &gt;&gt; 16 
0x0000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff 

如果增大右移的位数，那么得到的值就会减小，那么所谓的难度值就是右移的位数
右移到位数越大(难度越大)无数HASH256的运算得到小于右移后值，才算是满足的条件

例如，极端情况的理解
右移255位
0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff &gt;&gt; 255，得到的值是1
理论上，需要需要2^256 次HASH256运算，才能找到小于1的值
</code></pre>

<h3 id="toc_6">难度表示，难度目标与难度调整</h3>

<h4 id="toc_7">难度位</h4>

<p>&quot;bits&quot; : 难度位，简称“bits”，这个标记的值被保存位系数/指数格式，前两位十六进制数字为幂，接下来的六位是系数</p>

<pre><code class="language-text">计算难度目标的公式
coefficient 系数
exponent    幂数
target = coefficient * 2^(8*(exponent - 3))

例如：0x1903a30c，0x19为幂，0x03a30c为系数
target = 0x0000000000000003A30C00000000000000000000000000000000000000000000
也就是说有效区块的头信息哈希值是小于这个目标值的；
这个数字的二进制表示前60位都是0
在这个难度上，一个每秒可以处理1万亿个哈希计算的矿工，平均每天8496个区块，换句话来说，平均每59天，才能找到一个区块的正确的哈希值；

一般电脑 CPU 的算力是 20M Hash/s，即每秒产生 Hash 碰撞次数是 20M。
大约每秒2亿次，按照上面的难度值大约需要（5000*59 = 29.5万天）


单位换算
1 kH / s =每秒1,000哈希
1 MH / s =每秒1,000,000次哈希。
1 GH / s =每秒1,000,000,000次哈希。
1 TH / s =每秒1,000,000,000,000次哈希。
1 PH / s =每秒1,000,000,000,000,000次哈希。
1 EH / s =每秒1,000,000,000,000,000,000次哈希。
</code></pre>

<h4 id="toc_8">随机数</h4>

<p>&quot;nonce&quot; : 随机数，范围是（0至2<sup>32</sup> -1）<br/>
这个随机数一开始我是无法理解，按照计算的Hash(区块头(Version+PreviousBlockHash+MerkleRoot)+随机数)的方式，随机数是很容易超过2<sup>32</sup> -1的;<br/>
当nonce&gt;=2<sup>32</sup> -1的时候，将nonce=0，同时修改MerkleRoot(coinbase交易的值，得到新的Hash)，再来一轮的计算，至到找到符合条件的HASH值</p>

<p>随机值升位方案<br/>
使用coninbase交易作为额外随机值来源，因为coinbase脚本可以存储2-100个字节的数据，矿工Kia 会死使用这个空间作为额外的随机来源，运行他们去探索一个更大范围的有效区块，这个coinbase交易包含在merkle数中，这就意味着任何的coinbase变化都会到这merkle根的变化；8个字节的额外随机数，加上4个字节的标准随机数允许矿工每秒尝试2<sup>96中的可能性而无需修改时间戳，同理coinbase脚本可以提供更多的额外空间为将来的随机数扩展做准备</sup></p>

<h4 id="toc_9">难度值与调整</h4>

<p>&quot;difficulty&quot; :  难度值，在区块中并不记录，仅仅是为了直观感受解题难度而演变出的一个浮点数</p>

<p>难度系数 * 2<sup>256</sup> / 2<sup>224</sup> = 哈希碰撞的次数</p>

<p>换算浮动的等式<br/>
算力 * 时间 = 难度 * 常量（=2<sup>32</sup> ，为了表示难度值，可以是任何值）</p>

<p>D * 2<sup>32</sup> / 600<br/>
时间 = 难度 * 2<sup>32</sup> /算力</p>

<p>随着运算的提高，难度系统也再增加，每2014块（两周）会调整一下，难度系数，确保产生的块平均维持在10分钟左右，不至于过快的将币挖完；</p>

<p>【new_target】 = 【prev_target】 * 【前2015个区块生成所用的时间】 /  1209600 （按标准每10分钟出一个块，2016个块所需要的秒数）</p>

<p>为了防止难度变化的过快，每个周期的调整幅度都必须小于一个因子（值为4），如果调整的幅度大于4倍的话，按照4倍来调整</p>

<h2 id="toc_10">区块链的组装与选择</h2>

<p>比特币去中心化的共识机制的最后一步是将区块集合至最大工作量证明的链中，一旦一个节点验证了一个新的区块，它将尝试将新的区块连接到现存的区块链上，将它们组装起来</p>

<p>节点维护三种区块，第一个是连接到主链上的，第二种是从主链上产生分支的（备用链），第三种是在已知中没有找到已至的父区块的，在这个验证的过程中，一旦发现有不符合标准的地方，验证就会失败，这样的区块就会被节点拒绝，所以不会放在任何的一条链中</p>

<p>任何时候，主链都是累计了最大的难度的区块链，在一般情况下，主链也是包含最多区块的那个链，除非有等长的链并且其中一个有更多的工作量证明，主链也会有一些分支，这些分支中的区块与主链区块互为“兄弟”区块。这些区块是有效的，但不是主链的一部分，保留这些分支的目的是如果未来的某个时刻它们中的一个延长了并在难度中上超过主链，那么后续的区块就会应用它们。</p>

<p>当节点接收到了新的区块，它会尝试将这个区块插入到现有的区块链中，节点会看一下这个区块的previous block hash字段，是该区块对其父区块的引用，同时，新的节点将尝试在已存在的区块链中找出这个父区，大多数情况下，父区块是主块链的顶点，这就意味着这个新的区块延长了主链<br/>
不过，有时候新区块所延长的区块链并不是主链，接下来关于区块链的分叉会说明。在分叉的情况下，节点将新的区块添加到备用链，同时比较备用链与主链的难度，如果备用链比主链累计了更多的难度，节点将收敛于备用链，意味着节点将开始选择备用链作为其新的主链，而之前的那个老的主链则称为了备用链</p>

<p>如果节点收到了一个有效的区块，而在现有的区块链中却未找到它的父区块，那么这个区块被认为“孤块”，“孤块”会保存在孤块池中，至到他们的父块被节点收到，一旦收到了父块并且将其连接到现有到区块链上，节点就会从孤块池中取出，并且连接到它的父块上，作为区块链的一部分。<br/>
当两个区块在很短的时间间隔内挖出，节点有可能会以相反顺序接收到他们，这个时候孤块的现象就会出现</p>

<p>选择了最大难度的区块链后，所有的节点最终在全网范围内达成共识，随着更多的工作量证明被添加到链中，链的暂时性差异最终中会得到解决的。</p>

<h2 id="toc_11">区块链的分叉</h2>

<p>正常情况下，分叉发生在两名矿工在较短的时间内，各自都算得了工作量证明解的时候，两个矿工便立即传播自己“获胜”的区块到网络中，先是传播给相邻节点而后传播到整个网络，但是随着区块的长度的增加，会以分叉出最长的链为准。</p>

<h3 id="toc_12">挖矿</h3>

<h4 id="toc_13">CPU挖矿</h4>

<p>在 2009-2010 年期间，比特币的挖矿门槛相对极低。只要你有一台电脑并联上网，下载一个挖矿软件，加上一个比特币钱包，就能挖到很多。</p>

<p>2010 年 5 月 22 日，美国有一个叫 Laszlo Hanyecz 的程序员，挖了很多，他用 1 万枚比特币，在网络上找到一位网友买了两份价值 30 美元的披萨。<br/>
按照当时价格折算，1 枚比特币约 = 0.003 美元。</p>

<p>普通CPU挖矿的算力，20M Hash/s</p>

<h4 id="toc_14">GPU挖矿</h4>

<p>图像处理器，也就是显卡<br/>
将多个GPU组装在一起器算力最高可达400M Hash/s，相当于几十个CPU</p>

<p>很快，基于 GPU 挖比特币的软件被开发出来，GPU 挖矿开始流行起来，市场上曾一度买不到显卡。</p>

<p>随着比特币被越来越多人关注，到了 2011 年 6 月，比特币单枚成交价格创造历史新高，达到 31.9 美元，相比初始价格已上涨约 10,600 倍。</p>

<h4 id="toc_15">FPGA 挖矿</h4>

<p>2011 年底，一种基于 FPGA 芯片（Field－Programmable Gate Array，现场可编程逻辑门阵列）的挖矿设备出现了。</p>

<p>一张 FPGA 芯片的算力速度约为 200MHash/s，虽然比不上 GPU 芯片的算力，但是它的能耗更低。人们把多张 FPGA 芯片组装在一块，形成了 FPGA矿机，最大算力可达 25G Hash/s。</p>

<h4 id="toc_16">ASIC 矿机挖矿</h4>

<p>专用集成电路矿机，即 ASIC 矿机（Application-Specific Integrated Circuit，专用集成电路）横空出世。这种专门设计只做哈希值运算的设备，具有更高的算力，更低的能耗。</p>

<p>比如比特大陆生产的蚂蚁矿机，最高算力可达到 3.5T Hash/s，相当于 30000 多个 GPU 的算力，这种设备给到比特币网络的总算力是质的飞跃。</p>

<p>由于比特币挖矿是抢夺每 10 分钟出来的区块记账权，矿工们又开始组建矿池，把大量算力集中在一起来抢夺记账权。比特币网络上，全球已经形成了超过 20 个的大矿池。<br/>
更为可怕的是，在日夜不停运转的矿场中，电费是最大的能耗，曾有报道，在内蒙鄂尔多斯的大矿场，一个小时要用掉 40 兆瓦时的电，这相当于 12000 个家庭的日常用电量。</p>

<p>由此看来，ASIC 矿机的出现与应用，会造成巨大的资源浪费，是一种反商业逻辑的行为，同时也直接把中本聪最初设想的那个 “去中心化、人人自由平等” 的世界给抹杀掉了。</p>

<h4 id="toc_17">Ulord 全民挖矿</h4>

<p>Ulord 项目，致力于建设一个基于区块链技术的价值传播网络，打造一个开放、平等、尊重创造的区块链数字资源分发平台。</p>

<p>Ulord 原链上的 CPU 挖矿算法，叫做：CryptoHello 算法，这种算法采用了多级串行密码学原语操作，既针对 CPU 体系结构进行了优化，又具备永久防 ASIC 矿机。</p>

<p>在 CryptoHello 算法中，鼓励串行的 CPU，抵制并行的 ASIC 矿机。<br/>
2018 年 5 月 22 日，Ulord 主网正式上线，到时可以用个人电脑挖矿了</p>

<h2 id="toc_18">共识攻击</h2>

<p>被矿工或（矿池）试图用自己的算力实行欺骗或破坏<br/>
共识攻击只能影响整个区块链未来的共识，或者最多影响不久的过去的几个区块的共识（最多影响过去10个块），而随着时间的推移，整个比特币链被篡改的可能行越来越低</p>

<p>理论上，一个区块链分叉可以变的很长，但实际上，要想实现一个非常长的区块链分叉需要的算力是非常的，随着整个比特币的区块逐渐的增长，过去的区块基本上可以认为无法被分叉篡改</p>

<p>共识攻击时不能从其他的钱包哪里偷去比特币，不签名地支持支付，重新分配比特币，改变过去的交易或者改变比特币的持有记录，这些统统是无法更改的<br/>
唯一影响的是最新的区块（最多10个）并且通过拒绝服务来影响未来区块的生成</p>

<h3 id="toc_19">双重支付攻击</h3>

<p>共识攻击的一个典型的场景是“51%攻击”，想象这么一个场景，一群矿工控制了整个比特币的网络的51%的算力，由于这群矿工可以生成绝大数的块，他们就可以通过制造区块的分叉来实现“双重支付”或者通过拒绝服务的方式来阻止特定的交易或者攻击特点钱包的地址</p>

<p>例如，攻击者Mallory于Carol持有的“清明上河图”进行交易，Mallory通过转账1万个比特币给到Carol，尚未等到6个交易的确认，Carol将画交给了Mallory，此时，攻击者Mallory利用51%的算力进行攻击，重新计算包含这笔交易的区块，并且在新的块里将原来的交易替换成了另外一笔交易（比如，赚到Mallory另外的一个钱包中），从而实现了“双重支付”，这笔双重支付交易使用了和原来交易一致的UTXO，由于最终的分叉导致了这笔交易的无效</p>

<p>为了避免这类的攻击，售卖大宗商品的商家在交易得到全网的6个块确认之后再交付商品，或者商家应该使用第三方的多重签名的账户进行交易，并且也要等到交易账户获得全网多个确认之后再交付商品，一条交易的确认次数越多，就越难被攻击者通过51%攻击篡改</p>

<h3 id="toc_20">拒绝某个特定比特币地址提供服务</h3>

<p>一个拥有了系统绝大数算力的攻击者，可以轻易的忽略某一笔特定的交易，如果这个交易存在另一个矿工所产生的区块中，该攻击者可以故意分叉，然后重新产生新的区块，并且把想忽略的交易从区块中移除，这种攻击造成的结果是，拒绝为攻击钱包提供的地址服务</p>

<h3 id="toc_21">51%攻击</h3>

<p>并不是说算力要达道51%才能发起攻击，实际上，即时其拥有不到51%d的算力也可以尝试这种攻击，51%的命名是实际上是在攻击者的算力达到了51%这个阀值的时候，其发起的攻击尝试几乎肯定会成功</p>

<h2 id="toc_22">改变共识规则</h2>

<p>共识规则确定交易和块的有效性，这个规则是所有比特币节点之间协作的基础，共识规则在短期是不变的，并且所有的节点之间必须一致，但是长期以来他们总不是不变的，规则必须随时改变以适应新的功能，改进或修复错误，然而，与传统的软件开发不同，升级共识系统困难很多，需要所有参与者之间的协调</p>

<h3 id="toc_23">硬分叉</h3>

<p>当共识规则发生了变化，网络可能会分叉到两条链条，这种分叉称为硬分叉，这种分叉后，网络不会重新收敛到单个链路上，相反的是两条链子独立发展</p>

<p>硬分叉引入的变化不是向前兼容的，而是向后兼容的</p>

<p>以下的结构图，a是原链，b是分叉出来的链</p>

<pre><code class="language-mermaid">     graph LR
     Block1 --&gt; Block2 
     Block2  --&gt; Block3a 
     Block2  --&gt; Block3b  
        Block3b    
        Block3a  --&gt; Block4
        Block4  --&gt; Block5 
        Block5  --&gt; Block6a
        Block6a --&gt; Block7a
        Block5  --&gt; Block6b 
        Block6b  --&gt; Block7b 
        Block7b  --&gt; Block8 
        Block8  --&gt; Block9 
</code></pre>

<p>硬分叉分为四个阶段：软分叉，网络分叉，挖矿分叉和区块链分叉<br/>
每次硬分叉都是有很大争议的，都是存在很大的风险</p>

<h3 id="toc_24">分离矿工和难度</h3>

<p>由于矿工被分裂后，开始了开启两条的链条，链上的哈希算力也被分裂，这么两个链之间的挖矿能力可以分成任意比例，新的规则一开始可能是少数人跟随<br/>
假设我们采用二八原则的分割，大多数挖矿能力使用新的规则，那么旧的链条挖矿能力会下降，产生区块的时间会增加，可能达到了12分钟产生一个块，那么会动态的调整目标的难度的哈希值，将其难度减少20%，直至没10分钟产生一个区块</p>

<h3 id="toc_25">软分叉</h3>

<p>并非所有的共识规则的变化都会导致硬分叉，只有向前不兼容的共识规则的变化才会导致分叉，如果共识规则的改变也能够让未修改的客户端仍然按照先前的规则对待交易或者区块，那么就可以在不分叉的情况下实现共识的修改，这就是软分叉，实际上软分叉不是分叉，而是共识规则的向前兼容并做些变化，允许未升级的客户端继续与新规则同时工作</p>

<p>软分叉不是为了扩展，只能增加共识规则的约束</p>

<h4 id="toc_26">软分叉重新定义NOP操作码</h4>

<p>基于NOP操作码的重新解释，在比特币中实现了一些软分叉<br/>
Bitcoin脚本有10个操作码保留提供使用，NOP1到NOP10</p>

<p>例如，在BIP-65重新解释了NOP2操作码，将其解释为OP_CHECKLOCKTIMEVERIFY，并在其锁定脚本中包含该操作码的UTXO上，强制了绝对锁定的共识规则</p>

<h4 id="toc_27">其他方式软分叉升级</h4>

<p>NOP操作码事重新解释计划的，也是共识升级的明显机制<br/>
然而，最近引入了另外一种的分叉机制，不依赖于NOP操作码，用于非常特定类型的共识改变，这就是隔离见证的机制，Segwit是一个交易结构的体系变化，它将解锁脚本见证从交易的内部移动到了外部的数据结构（将其隔离） </p>

<p>Segwit最初的设想是硬分叉，主要是因为修改了交易的结构，不过后来通过软件包引入segwit，在隔离见证的规则下修改创建的UTXO的锁定脚本修改，使得未修改的客户端将任何锁定脚本视为可锁定脚本</p>

<p>因此，引入Segwit就是软分叉，而不需要每个节点必须从链上升级或拆分网络</p>

<h4 id="toc_28">对软分叉的批评</h4>

<p>基于NOP操作码的软分叉是相对无争议的，但是许多开发人员担心软分叉升级的其他方法会产生不可接收的折衷</p>

<ul>
<li><p>技术性债务<br/>
软分叉在技术上更为复杂，代码复杂又增加了错误和安全漏洞的可能性</p></li>
<li><p>验证放松<br/>
未经修改的客户端将交易视为有效，而不评估修改的共识规则，实际上，未经过修改的客户端不会使用全协商一致的规则来验证，因为他们对新规则无视</p></li>
<li><p>不可逆转升级<br/>
因为软分叉产生额外的共识约束的交易，所以他们在实践中称为了不可逆转的升级，如果软分叉升级在被激活后被退回，根据新的规则创建的任何交易都可能导致旧的规则下的资金损失。例如，如果根据旧规则对CTLV交易进行评估，则不存任何时间锁定的约束，并且可以花费在任何的时间，因此，由于错误而不得不被回退的失败的软分叉几乎肯定会导致资金的流失</p></li>
</ul>

<h2 id="toc_29">使用区块版本发出软分叉信号</h2>

<p>由于软分叉允许未经过修改的客户在协商的情况下继续运作，“激活”软分叉的机制是通过向矿工发出信号准备：大多数矿工必须同意他们准备并愿意执行新的共识规则<br/>
为了协调他们的行动，有一个信号机制，是他们能够表达对共识规则改变的支持，例如该机制在2013年3月激活BIP-34并在2016年7月被BIP-9激活所取代</p>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="15358585289735.html" 
          title="Previous Post: 一篇对比特币网络的理解">&laquo; 一篇对比特币网络的理解</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="15358584238347.html" 
          title="Next Post: 一篇对比特币脚本的理解">一篇对比特币脚本的理解 &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          

          
            <div id="disqus_thread"></div>
          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <h1>我对区块链的理解</h1>
                <div class="site-des">对区块链的思考</div>
                <div class="social">







<a target="_blank" class="weibo" href="https://weibo.com" title="weibo">Weibo</a>

<a target="_blank" class="github" target="_blank" href="https://github.com" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:spzhongwin@google.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="about.html"><strong>关于</strong></a>
        
            <a href="bit.html"><strong>比特币</strong></a>
        
            <a href="ethereum.html"><strong>以太坊</strong></a>
        
            <a href="poofAlgorithm.html"><strong>共识算法</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15427648634917.html">分布式共识</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15397582057010.html">一篇关于区块BerkeleyDB的存储</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15397440071875.html">一篇关于最新比特币技术的说明</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15396726640663.html">Raft</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15396726536666.html">Paxos</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2018
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>


<script type="text/javascript">
    var disqus_shortname = 'coderforart'; 

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
var disqus_shortname = 'coderforart'; 

(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = '//' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    



  </body>
</html>
